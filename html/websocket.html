<!DOCTYPE html>
<head>
  <meta charset="utf-8" />
  <title>WebSocket Test</title>

  <!--
  	版本：1.0<br/>
  	作者：OKCoin<br/>
  -->
  <script type="text/javascript" src="MD5.js"></script>
      <script src="echarts.min.js"></script>
</head>
<body>
<h2 id="th2">WebSocket Test</h2>
<div id="status"></div>
<div id="kline">
    <table>
        <thead></thead>
        <tbody>
        </tbody>
    </table>
</div>
<div id="output"></div>
<div id="main" style="width: 600px;height:400px;"></div>

<script type="text/javascript">
	var okCoinWebSocket = {};
        var myChart = echarts.init(document.getElementById('main'));

            function RefreshBtcKLine(klineData)
            {
          		var str = '<table id="tdata" border="1">\r\n<tr id="tr0">\r\n';
          		for ( var index in array[0]) {
          			str += '<th>' + index + '</th>\r\n';
          		}
          		str += '</tr>\r\n';

          		for ( var i = 0; i < array.length; i++) {
          			str += '<tr id="tr' + (i+1) + '">\r\n';
          			for ( var j in array[i]) {
          				str += '<td>' + JSON.stringify(array[i][j]) + '</td>\r\n';
          				//if(typeof array[i][j] == 'string' && array[i][j].indexOf("ok_") >= 0) {
          					//console.log(array[i][j]);
          				//}
          			}
          			str += '</tr>\r\n';
          		}

          		str += '</table>\r\n';
          		document.getElementById("output").innerHTML += str;
            }


            //app.title = '2015 年上证指数';

            var rawData = [
              ['2015/12/31','3570.47','3539.18','-33.69','-0.94%','3538.35','3580.6','176963664','25403106','-']
            ].reverse();

            function calculateMA(dayCount, data) {
                var result = [];
                for (var i = 0, len = data.length; i < len; i++) {
                    if (i < dayCount) {
                        result.push('-');
                        continue;
                    }
                    var sum = 0;
                    for (var j = 0; j < dayCount; j++) {
                        sum += data[i - j][1];
                    }
                    result.push(sum / dayCount);
                }
                return result;
            }


            var dates = rawData.map(function (item) {
                return item[0];
            });

            var data = rawData.map(function (item) {
                return [+item[1], +item[2], +item[5], +item[6]];
            });
            var option = {
                backgroundColor: '#21202D',
                legend: {
                    data: ['日K', 'MA5', 'MA10', 'MA20', 'MA30'],
                    inactiveColor: '#777',
                    textStyle: {
                        color: '#fff'
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        animation: false,
                        type: 'cross',
                        lineStyle: {
                            color: '#376df4',
                            width: 2,
                            opacity: 1
                        }
                    }
                },
                xAxis: {
                    type: 'category',
                    data: dates,
                    axisLine: { lineStyle: { color: '#8392A5' } }
                },
                yAxis: {
                    scale: true,
                    axisLine: { lineStyle: { color: '#8392A5' } },
                    splitLine: { show: false }
                },
                grid: {
                    bottom: 80
                },
                dataZoom: [{
                    textStyle: {
                        color: '#8392A5'
                    },
                    handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
                    handleSize: '80%',
                    dataBackground: {
                        areaStyle: {
                            color: '#8392A5'
                        },
                        lineStyle: {
                            opacity: 0.8,
                            color: '#8392A5'
                        }
                    },
                    handleStyle: {
                        color: '#fff',
                        shadowBlur: 3,
                        shadowColor: 'rgba(0, 0, 0, 0.6)',
                        shadowOffsetX: 2,
                        shadowOffsetY: 2
                    }
                }, {
                    type: 'inside'
                }],
                animation: false,
                series: [
                    {
                        type: 'candlestick',
                        name: '日K',
                        data: data,
                        itemStyle: {
                            normal: {
                                color: '#FD1050',
                                color0: '#0CF49B',
                                borderColor: '#FD1050',
                                borderColor0: '#0CF49B'
                            }
                        }
                    },
                    {
                        name: 'MA5',
                        type: 'line',
                        data: calculateMA(5, data),
                        smooth: true,
                        showSymbol: false,
                        lineStyle: {
                            normal: {
                                width: 1
                            }
                        }
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10, data),
                        smooth: true,
                        showSymbol: false,
                        lineStyle: {
                            normal: {
                                width: 1
                            }
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20, data),
                        smooth: true,
                        showSymbol: false,
                        lineStyle: {
                            normal: {
                                width: 1
                            }
                        }
                    },
                    {
                        name: 'MA30',
                        type: 'line',
                        data: calculateMA(30, data),
                        smooth: true,
                        showSymbol: false,
                        lineStyle: {
                            normal: {
                                width: 1
                            }
                        }
                    }
                ]
            };

myChart.setOption(option);
	okCoinWebSocket.init = function(uri, apiKey, secretKey) {
		this.wsUri = uri;
		this.apiKey = apiKey;
		this.secretKey = secretKey;
		this.lastHeartBeat = new Date().getTime();
		this.overtime = 8000;

        okCoinWebSocket.websocket = new WebSocket(okCoinWebSocket.wsUri);

        //print(ShowObjects(okCoinWebSocket.websocket));

		okCoinWebSocket.websocket.onopen = function(evt) {
			onOpen(evt)
		};
		okCoinWebSocket.websocket.onclose = function(evt) {
			onClose(evt)
		};
		okCoinWebSocket.websocket.onmessage = function(evt) {
			onMessage(evt)
		};
		okCoinWebSocket.websocket.onerror = function(evt) {
			onError(evt)
		};

        alert(okCoinWebSocket.wsUri);
        console.log(this);
		//setInterval(checkConnect,5000);
	}

    function ShowObjects(obj)
    {
        var s;
        for(var i in obj)
        {
            s+= i+":"+obj[i]+"\n<br/>";
        }
        return s;
    }

	function checkConnect() {
        //print(ShowObjects(okCoinWebSocket.websocket));
        console.log(okCoinWebSocket.websocket);
		okCoinWebSocket.websocket.send("{'event':'ping'}");
		if ((new Date().getTime() - okCoinWebSocket.lastHeartBeat) > okCoinWebSocket.overtime) {
			onsole.log("socket 连接断开，正在尝试重新建立连接");
			testWebSocket();
		}
	}

	function onOpen(evt) {
		print("CONNECTED");

		doSend("{'event':'addChannel','channel':'ok_sub_spotcny_btc_kline_1min'}");
		//现货交易、合约交易测试
		//tradeTest();

		//********                            测试数据                                                                 *******/
		//////////////////现货行情//////////////////////////////////////////////////
		doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_ticker'}");
		doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_ticker'}");

		doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_depth_20'}");
		doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_depth_60'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_depth_20'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_depth_60'}");

		doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_trades'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_trades'}");

		doSend("{'event':'addChannel','channel':'ok_btcusd_kline_3min'}");

    doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_1min'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_1min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_3min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_5min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_15min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_30min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_1hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_2hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_4hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_6hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_12hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_day'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_3day'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_week'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_1min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_3min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_5min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_15min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_30min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_1hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_2hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_4hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_6hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_12hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_day'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_3day'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_week'}");
		//////////////////现货行情//////////////////////////////////////////////////

		//////////////合约行情//////////////////////////////////////////////////////
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_ticker_this_week'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_ticker_next_week'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_ticker_quarter'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_ticker_this_week'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_ticker_next_week'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_ticker_quarter'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_1min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_3min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_5min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_15min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_30min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_1hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_2hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_4hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_6hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_12hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_day'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_3day'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_week'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_next_week_1min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_quarter_1min'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_kline_this_week_1min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_kline_next_week_1min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_kline_quarter_1min'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_depth_this_week_20'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_depth_this_week_60'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_depth_next_week_20'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_depth_next_week_60'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_depth_quarter_20'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_depth_quarter_60'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_depth_this_week_20'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_depth_this_week_60'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_depth_next_week_20'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_depth_next_week_60'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_depth_quarter_20'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_depth_quarter_60'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_trade_this_week'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_trade_next_week'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_trade_quarter'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_trade_this_week'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_trade_next_week'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_trade_quarter'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_index'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_index'}");
		//////////////合约行情//////////////////////////////////////////////////////
	}

	function tradeTest(){
		//现货交易
		//spotTrade();
		//spotCancelOrder(100);
		//spotUserInfo();
		//spotOrderInfo();
		//spotTrades();
		//spotUserinfos();

		//合约交易
		//futureTrade();
		//futureCancelOrder(100);
		//futureUserInfo();
		//futureOrderInfo(100);
		//futureTrades();
		//futureUserinfos();
		//futurePositions();
	}

	function onClose(evt) {
		print("DISCONNECTED");
	}

  function  formatDate(dateObj)   {
      var str,colorhead,colorfoot;

      str = dateObj.getUTCFullYear() + '/' + (dateObj.getUTCMonth() +1 ) + '/' + dateObj.getUTCDate();//
      // + " " + hh + ":" + mm + ":" + ss;
      return(str);
  }

	function onMessage(e) {
		console.log(new Date().getTime() + ": " + e.data)
		var array = JSON.parse(e.data);

		for (var i = 0; i < array.length; i++) {
			for (var j = 0;j < array[i].length; j++) {
				var isTrade = false;
				var isCancelOrder = false;

				if (array[i][j] == 'ok_spotusd_trade' || array[i][j] == 'ok_spotcny_trade') {
					isTrade = true;
				} else if (array[i][j] == 'ok_spotusd_cancel_order'
						|| array[i][j] == 'ok_spotcny_cancel_order') {
					isCancelOrder = true;
				}

				var order_id = array[i][j].order_id;
				if (typeof (order_id) != 'undefined') {
					if (isTrade) {
						//下单成功 业务代码
						console.log("orderId is  " + order_id);
					} else if (isCancelOrder) {
						//取消订单成功 业务代码
						console.log("order  " + order_id + " is now cancled");
					}
				}
			}
		}

		if (array.event == 'pong') {
			okCoinWebSocket.lastHeartBeat = new Date().getTime();
		} else {
			//createTable(array);
      console.log(array[0].channel);
      if(array[0].channel == "ok_sub_futureusd_btc_kline_this_week_1min")
      {
        var kdata = array[0].data;
        var timestamp = kdata[0][0];
        alert(timestamp);
        var date = new Date(timestamp * 1000);
        kdata[0][0] = formatDate(date);
        rawData = rawData.concat(kdata);
        console.log(rawData);
        console.log(array);
        console.log(kdata);
      }
		}
	}

	function onError(evt) {
		print('<span style="color: red;">ERROR:</span> ' + evt.data);
        console.log('<span style="color: red;">ERROR:</span> ' + evt.data);
	}

	function doSend(message) {
        console.log("SENT: " + message);
		print("SENT: " + message);
		okCoinWebSocket.websocket.send(message);
	}

	function print(message) {
		var status = document.getElementById("status");
		status.style.wordWrap = "break-word";
		status.innerHTML += message + "<br/>";
	}

	function createTable(array) {
		var str = '<table id="tdata" border="1">\r\n<tr id="tr0">\r\n';
		for ( var index in array[0]) {
			str += '<th>' + index + '</th>\r\n';
		}
		str += '</tr>\r\n';

		for ( var i = 0; i < array.length; i++) {
			str += '<tr id="tr' + (i+1) + '">\r\n';
			for ( var j in array[i]) {
				str += '<td>' + JSON.stringify(array[i][j]) + '</td>\r\n';
				//if(typeof array[i][j] == 'string' && array[i][j].indexOf("ok_") >= 0) {
					//console.log(array[i][j]);
				//}
			}
			str += '</tr>\r\n';
		}

		str += '</table>\r\n';
		document.getElementById("output").innerHTML += str;
	}

	//现货下单
	function spotTrade() {
		var sign = MD5("amount=0.1&api_key=" + okCoinWebSocket.api_key
				+ "&symbol=ltc_usd&type=sell_market&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_spotusd_trade','parameters':{'api_key':'" + okCoinWebSocket.api_key
				+ "','sign':'" + sign + "','symbol':'ltc_usd','type':'sell_market','amount':0.1}}");
	}

	//现货取消订单
	function spotCancelOrder(orderId) {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&order_id=" + orderId
				+ "&symbol=ltc_usd&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_spotusd_cancel_order','parameters':{'api_key':'" + okCoinWebSocket.api_key
				+ "','sign':'" + sign + "','symbol':'ltc_usd','order_id':'" + orderId + "'}}");
	}

	//现货个人信息
	function spotUserInfo() {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_spotusd_userinfo','parameters' :{'api_key':'"
				+ okCoinWebSocket.api_key + "','sign':'" + sign + "'}}");
	}

	//查询订单信息
	function spotOrderInfo(){
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&order_id=20914907&secret_key=" + okCoinWebSocket.secret_key + "&symbol=ltc_usd");
		doSend("{'event':'addChannel','channel':'ok_spotusd_orderinfo','parameters' :{'api_key':'"
				+ okCoinWebSocket.api_key + "','symbol':'ltc_usd','order_id':'20914907','sign':'" + sign + "'}}");
	}
	//订阅交易数据
	function spotTrades() {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_sub_spotusd_trades','parameters' :{'api_key':'"
				+ okCoinWebSocket.api_key + "','sign':'" + sign + "'}}");
	}
	//订阅账户信息
	function spotUserinfos() {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_sub_spotusd_userinfo','parameters' :{'api_key':'"
				+ okCoinWebSocket.api_key + "','sign':'" + sign + "'}}");
	}

	//合约下单
	function futureTrade() {
		var sign = MD5("amount=1&api_key=" + okCoinWebSocket.api_key +
				"&contract_type=this_week&lever_rate=20&match_price=1&price=1.5&symbol=ltc_usd&type=0&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event': 'addChannel','channel':'ok_futureusd_trade','parameters': {'api_key': '"
				+ okCoinWebSocket.api_key + "','sign': '" + sign + "','symbol': 'ltc_usd','contract_type': 'this_week','amount': '1','price': '1.5','type': '0','match_price': '1','lever_rate': '20'}}");
	}

	//合约取消订单
	function futureCancelOrder(orderId) {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&contract_type=this_week&order_id=" + orderId
				+ "&symbol=ltc_usd&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event': 'addChannel','channel': 'ok_futureusd_cancel_order','parameters': {'api_key': '"
				+ okCoinWebSocket.api_key + "','sign': '" + sign + "','symbol': 'ltc_usd','order_id': '" + orderId
				+ "','contract_type': 'this_week'}}");
	}

	//合约个人信息
	function futureUserInfo() {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_futureusd_userinfo','parameters' :{'api_key':'"
				+ okCoinWebSocket.api_key + "','sign':'" + sign + "'}}");
	}

	//查询合约订单
	function futureOrderInfo(orderId) {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&contract_type=this_week&current_page=1&order_id=" + orderId
				+ "&page_length=1&symbol=ltc_usd&secret_key=" + okCoinWebSocket.secret_key + "&status=1");
		doSend("{'event': 'addChannel','channel': 'ok_futureusd_orderinfo','parameters': {'api_key': '"
				+ okCoinWebSocket.api_key + "','sign': '" + sign + "','symbol': 'ltc_usd','order_id': '" + orderId
				+ "','contract_type': 'this_week','status':'1','current_page':'1','page_length':'1'}}");
	}

	//订阅合约交易数据
	function futureTrades() {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_sub_futureusd_trades','parameters' :{'api_key':'"
				+ okCoinWebSocket.api_key + "','sign':'" + sign + "'}}");
	}

	//订阅合约账户信息
	function futureUserinfos() {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_sub_futureusd_userinfo','parameters' :{'api_key':'"
				+ okCoinWebSocket.api_key + "','sign':'" + sign + "'}}");
	}

	//订阅合约持仓信息
	function futurePositions() {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_sub_futureusd_positions','parameters' :{'api_key':'"
				+ okCoinWebSocket.api_key + "','sign':'" + sign + "'}}");
	}

	window.onload = okCoinWebSocket.init("wss://real.okex.com:10440/websocket/okexapi", "", "");
    //okCoinWebSocket.websocket.Open();
    //onOpen();
</script>
</body>
</html>
