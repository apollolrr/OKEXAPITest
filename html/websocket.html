<!DOCTYPE html>
<head>
  <meta charset="utf-8" />
  <title>WebSocket Test</title>

  <!--
  	版本：1.0<br/>
  	作者：OKCoin<br/>
  -->
  <script type="text/javascript" src="MD5.js"></script>
      <script src="echarts.min.js"></script>
</head>
<body>
<h2 id="th2">WebSocket Test</h2>
<div id="status"></div>
<div id="kline">
    <table>
        <thead></thead>
        <tbody>
        </tbody>
    </table>
</div>
<div id="output"></div>
<div id="main" style="width:800px;height:400px;"></div>

<script type="text/javascript">
	var okCoinWebSocket = {};
  var myChart = echarts.init(document.getElementById('main'));
      function RefreshBtcKLine(klineData)
      {
    		var str = '<table id="tdata" border="1">\r\n<tr id="tr0">\r\n';
    		for ( var index in array[0]) {
    			str += '<th>' + index + '</th>\r\n';
    		}
    		str += '</tr>\r\n';

    		for ( var i = 0; i < array.length; i++) {
    			str += '<tr id="tr' + (i+1) + '">\r\n';
    			for ( var j in array[i]) {
    				str += '<td>' + JSON.stringify(array[i][j]) + '</td>\r\n';
    				//if(typeof array[i][j] == 'string' && array[i][j].indexOf("ok_") >= 0) {
    					//console.log(array[i][j]);
    				//}
    			}
    			str += '</tr>\r\n';
    		}

    		str += '</table>\r\n';
    		document.getElementById("output").innerHTML += str;
      }


      //app.title = '2015 年上证指数';

      var rawData = [
        //['2015/12/31','3570.47','3539.18','-33.69','-0.94%','3538.35','3580.6','176963664','25403106','-']
      ].reverse();

      function calculateMA(dayCount) {
          var result = [];
          for (var i = 0, len = data0.values.length; i < len; i++) {
              if (i < dayCount) {
                  result.push('-');
                  continue;
              }
              var sum = 0;
              for (var j = 0; j < dayCount; j++) {
                  sum += parseFloat(data0.values[i - j][1]);
              }
              console.log('sum:'+sum);
              console.log(sum / dayCount);
              result.push(sum / dayCount);
          }
          return result;
      }


      var dates = rawData.map(function (item) {
          return item[0];
      });

      var data0 = rawData;
      var option = {
      };
      var upColor = '#ec0000';
      var upBorderColor = '#8A0000';
      var downColor = '#00da3c';
      var downBorderColor = '#008F28';

  function splitData(rawData) {
    console.log("-----------------------");
    //console.log(rawData);
      var categoryData = [];
      var values = []
      for (var i = 0; i < rawData.length; i++) {
          //console.log(i);
          //console.log(rawData[i]);
          //console.log(rawData[i].splice(0, 1)[0]);
          categoryData.push(rawData[i][0]);
          values.push([rawData[i][1],rawData[i][2],rawData[i][5],rawData[i][6]]);
      }
      //console.log(values);
      return {
          categoryData: categoryData,
          values: values
      };
  }

function RefreshChartOpt()
{
  //rawData.map(function (item) {
  //  return [+item[1], +item[2], +item[5], +item[6]];
  //})
  //console.log(rawData);
  data0 = splitData(rawData);
  //console.log(data0.values[1]);
  option = {
    title: {
        text: 'OKEX SPOT _KLine 3min',
        left: 0
    },
    tooltip: {
        trigger: 'axis',
        axisPointer: {
            type: 'cross'
        }
    },
    legend: {
        data: ['日K', 'MA5', 'MA10', 'MA20', 'MA30']
    },
    grid: {
        left: '10%',
        right: '10%',
        bottom: '15%'
    },
    xAxis: {
        type: 'category',
        data: data0.categoryData,
        scale: true,
        boundaryGap : false,
        axisLine: {onZero: false},
        splitLine: {show: false},
        splitNumber: 20,
        min: 'dataMin',
        max: 'dataMax'
    },
    yAxis: {
        scale: true,
        splitArea: {
            show: true
        }
    },
    dataZoom: [
        {
            type: 'inside',
            start: 50,
            end: 100
        },
        {
            show: true,
            type: 'slider',
            y: '90%',
            start: 50,
            end: 100
        }
    ],
    series: [
        {
            name: '日K',
            type: 'candlestick',
            data: data0.values,
            itemStyle: {
                normal: {
                    color: upColor,
                    color0: downColor,
                    borderColor: upBorderColor,
                    borderColor0: downBorderColor
                }
            },
            markPoint: {
                label: {
                    normal: {
                        formatter: function (param) {
                            return param != null ? Math.round(param.value) : '';
                        }
                    }
                },
                data: [
                    {
                        name: 'XX标点',
                        coord: ['2013/5/31', 2300],
                        value: 2300,
                        itemStyle: {
                            normal: {color: 'rgb(41,60,85)'}
                        }
                    },
                    {
                        name: 'highest value',
                        type: 'max',
                        valueDim: 'highest'
                    },
                    {
                        name: 'lowest value',
                        type: 'min',
                        valueDim: 'lowest'
                    },
                    {
                        name: 'average value on close',
                        type: 'average',
                        valueDim: 'close'
                    }
                ],
                tooltip: {
                    formatter: function (param) {
                        return param.name + '<br>' + (param.data.coord || '');
                    }
                }
            },
            markLine: {
                symbol: ['none', 'none'],
                data: [
                    [
                        {
                            name: 'from lowest to highest',
                            type: 'min',
                            valueDim: 'lowest',
                            symbol: 'circle',
                            symbolSize: 10,
                            label: {
                                normal: {show: false},
                                emphasis: {show: false}
                            }
                        },
                        {
                            type: 'max',
                            valueDim: 'highest',
                            symbol: 'circle',
                            symbolSize: 10,
                            label: {
                                normal: {show: false},
                                emphasis: {show: false}
                            }
                        }
                    ],
                    {
                        name: 'min line on close',
                        type: 'min',
                        valueDim: 'close'
                    },
                    {
                        name: 'max line on close',
                        type: 'max',
                        valueDim: 'close'
                    }
                ]
            }
        },
        {
            name: 'MA5',
            type: 'line',
            data: calculateMA(5),
            smooth: true,
            lineStyle: {
                normal: {opacity: 0.5}
            }
        },
        {
            name: 'MA10',
            type: 'line',
            data: calculateMA(10),
            smooth: true,
            lineStyle: {
                normal: {opacity: 0.5}
            }
        },
        {
            name: 'MA20',
            type: 'line',
            data: calculateMA(20),
            smooth: true,
            lineStyle: {
                normal: {opacity: 0.5}
            }
        },
        {
            name: 'MA30',
            type: 'line',
            data: calculateMA(30),
            smooth: true,
            lineStyle: {
                normal: {opacity: 0.5}
            }
        },

    ]
};
}

myChart.setOption(option);
	okCoinWebSocket.init = function(uri, apiKey, secretKey) {
		this.wsUri = uri;
		this.apiKey = apiKey;
		this.secretKey = secretKey;
		this.lastHeartBeat = new Date().getTime();
		this.overtime = 8000;

        okCoinWebSocket.websocket = new WebSocket(okCoinWebSocket.wsUri);

        //print(ShowObjects(okCoinWebSocket.websocket));

		okCoinWebSocket.websocket.onopen = function(evt) {
			onOpen(evt)
		};
		okCoinWebSocket.websocket.onclose = function(evt) {
			onClose(evt)
		};
		okCoinWebSocket.websocket.onmessage = function(evt) {
			onMessage(evt)
		};
		okCoinWebSocket.websocket.onerror = function(evt) {
			onError(evt)
		};

        alert(okCoinWebSocket.wsUri);
        console.log(this);
		//setInterval(checkConnect,5000);
	}

    function ShowObjects(obj)
    {
        var s;
        for(var i in obj)
        {
            s+= i+":"+obj[i]+"\n<br/>";
        }
        return s;
    }

	function checkConnect() {
        //print(ShowObjects(okCoinWebSocket.websocket));
        console.log(okCoinWebSocket.websocket);
		okCoinWebSocket.websocket.send("{'event':'ping'}");
		if ((new Date().getTime() - okCoinWebSocket.lastHeartBeat) > okCoinWebSocket.overtime) {
			onsole.log("socket 连接断开，正在尝试重新建立连接");
			testWebSocket();
		}
	}

	function onOpen(evt) {
		print("CONNECTED");

		doSend("{'event':'addChannel','channel':'ok_sub_spotcny_btc_kline_1min'}");
    doSend("{'event':'addChannel','channel':'ok_sub_spot_ltc_btc_kline_1min'}");
		//现货交易、合约交易测试
		//tradeTest();

		//********                            测试数据                                                                 *******/
		//////////////////现货行情//////////////////////////////////////////////////
		//doSend("{'event':'addChannel','channel':'ok_sub_spot_bch_btc_ticker'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_ticker'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_depth_20'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_depth_60'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_depth_20'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_depth_60'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_trades'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_trades'}");

		//doSend("{'event':'addChannel','channel':'ok_btcusd_kline_3min'}");

    //doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_3min'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_1min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_3min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_5min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_15min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_30min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_1hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_2hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_4hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_6hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_12hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_day'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_3day'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_btc_kline_week'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_1min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_3min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_5min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_15min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_30min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_1hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_2hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_4hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_6hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_12hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_day'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_3day'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_spotusd_ltc_kline_week'}");
		//////////////////现货行情//////////////////////////////////////////////////

		//////////////合约行情//////////////////////////////////////////////////////
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_ticker_this_week'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_ticker_next_week'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_ticker_quarter'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_ticker_this_week'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_ticker_next_week'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_ticker_quarter'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_1min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_3min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_5min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_15min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_30min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_1hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_2hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_4hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_6hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_12hour'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_day'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_3day'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_this_week_week'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_next_week_1min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_kline_quarter_1min'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_kline_this_week_1min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_kline_next_week_1min'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_kline_quarter_1min'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_depth_this_week_20'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_depth_this_week_60'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_depth_next_week_20'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_depth_next_week_60'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_depth_quarter_20'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_depth_quarter_60'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_depth_this_week_20'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_depth_this_week_60'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_depth_next_week_20'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_depth_next_week_60'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_depth_quarter_20'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_depth_quarter_60'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_trade_this_week'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_trade_next_week'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_trade_quarter'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_trade_this_week'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_trade_next_week'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_trade_quarter'}");

		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_btc_index'}");
		//doSend("{'event':'addChannel','channel':'ok_sub_futureusd_ltc_index'}");
		//////////////合约行情//////////////////////////////////////////////////////
	}

	function tradeTest(){
		//现货交易
		//spotTrade();
		//spotCancelOrder(100);
		//spotUserInfo();
		//spotOrderInfo();
		//spotTrades();
		//spotUserinfos();

		//合约交易
		//futureTrade();
		//futureCancelOrder(100);
		//futureUserInfo();
		//futureOrderInfo(100);
		//futureTrades();
		//futureUserinfos();
		//futurePositions();
	}

	function onClose(evt) {
		print("DISCONNECTED");
	}

  function  formatDate(dateObj)   {
      var str,colorhead,colorfoot;

      str =dateObj.getUTCFullYear() + '/' + (dateObj.getUTCMonth() +1 )
      + '/' + dateObj.getUTCDate() + " " +dateObj.getUTCHours()
      +":"+dateObj.getUTCMinutes() + ":" + dateObj.getUTCSeconds();//
      //str = dateObj.toLocaleString();//
      // + " " + hh + ":" + mm + ":" + ss;
      return(str);
  }

  function AddKandleItem(item)
  {
    var kItem = new Array();
    var timestamp = item[0];
    var date = new Date(timestamp*1);
    console.log(timestamp);
    //kdata[0][0] = formatDate(date);
    kItem.push(formatDate(date));
    kItem.push(item[1]);
    kItem.push(item[4]);
    kItem.push("-=");
    kItem.push("-+");
    kItem.push(item[3]);
    kItem.push(item[2]);
    kItem.push(item[5]);
    kItem.push(item[6]);
    kItem.push("-");
    console.log("===============");
    //console.log(kItem);
    //console.log(kItem.length + ":" + kItem[0]);
    rawData.push(kItem);
    //console.log(kItem.length);
    //console.log(rawData.length);
    //console.log(rawData);
      RefreshChartOpt();
      myChart.setOption(option);
  }

  function AddTickerItem(item)
  {
    var kItem = new Array();
    var timestamp = item['timestamp'];
    var date = new Date(timestamp*1);
    console.log(timestamp);
    //kdata[0][0] = formatDate(date);
    kItem.push(formatDate(date));
    kItem.push(item['open']);
    kItem.push(item['close']);
    kItem.push("-=");
    kItem.push("-+");
    kItem.push(item['buy']);
    kItem.push(item['sell']);
    kItem.push(item['high']);
    kItem.push(item['low']);
    kItem.push("-");
    console.log("===============");
    //console.log(kItem);
    //console.log(kItem.length + ":" + kItem[0]);
    rawData.push(kItem);
    //console.log(kItem.length);
    //console.log(rawData.length);
    //console.log(rawData);
      RefreshChartOpt();
      myChart.setOption(option);
  }

	function onMessage(e) {
		console.log(new Date().getTime() + ": " + e.data)
		var array = JSON.parse(e.data);

		for (var i = 0; i < array.length; i++) {
			for (var j = 0;j < array[i].length; j++) {
				var isTrade = false;
				var isCancelOrder = false;

				if (array[i][j] == 'ok_spotusd_trade' || array[i][j] == 'ok_spotcny_trade') {
					isTrade = true;
				} else if (array[i][j] == 'ok_spotusd_cancel_order'
						|| array[i][j] == 'ok_spotcny_cancel_order') {
					isCancelOrder = true;
				}

				var order_id = array[i][j].order_id;
				if (typeof (order_id) != 'undefined') {
					if (isTrade) {
						//下单成功 业务代码
						console.log("orderId is  " + order_id);
					} else if (isCancelOrder) {
						//取消订单成功 业务代码
						console.log("order  " + order_id + " is now cancled");
					}
				}
			}
		}

    console.log(array[0].channel);
		if (array.event == 'pong') {
			okCoinWebSocket.lastHeartBeat = new Date().getTime();
		} else {
			//createTable(array);
      console.log(array[0].channel);
      if(array[0].channel == "ok_sub_futureusd_btc_kline_this_week_3min" ||
          array[0].channel == "ok_sub_spot_ltc_btc_kline_1min")
      {
        var kdata = array[0].data;
        AddKandleItem(kdata[0]);
        console.log(kdata);
      }
      else if(array[0].channel == "ok_sub_spot_bch_btc_ticker")
      {
          var kdata = array[0].data;
            console.log(kdata);
          AddTickerItem(kdata);
          console.log(kdata);
      }
		}
	}

	function onError(evt) {
		print('<span style="color: red;">ERROR:</span> ' + evt.data);
        console.log('<span style="color: red;">ERROR:</span> ' + evt.data);
	}

	function doSend(message) {
        console.log("SENT: " + message);
		print("SENT: " + message);
		okCoinWebSocket.websocket.send(message);
	}

	function print(message) {
		var status = document.getElementById("status");
		status.style.wordWrap = "break-word";
		status.innerHTML += message + "<br/>";
	}

	function createTable(array) {
		var str = '<table id="tdata" border="1">\r\n<tr id="tr0">\r\n';
		for ( var index in array[0]) {
			str += '<th>' + index + '</th>\r\n';
		}
		str += '</tr>\r\n';

		for ( var i = 0; i < array.length; i++) {
			str += '<tr id="tr' + (i+1) + '">\r\n';
			for ( var j in array[i]) {
				str += '<td>' + JSON.stringify(array[i][j]) + '</td>\r\n';
				//if(typeof array[i][j] == 'string' && array[i][j].indexOf("ok_") >= 0) {
					//console.log(array[i][j]);
				//}
			}
			str += '</tr>\r\n';
		}

		str += '</table>\r\n';
		document.getElementById("output").innerHTML += str;
	}

	//现货下单
	function spotTrade() {
		var sign = MD5("amount=0.1&api_key=" + okCoinWebSocket.api_key
				+ "&symbol=ltc_usd&type=sell_market&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_spotusd_trade','parameters':{'api_key':'" + okCoinWebSocket.api_key
				+ "','sign':'" + sign + "','symbol':'ltc_usd','type':'sell_market','amount':0.1}}");
	}

	//现货取消订单
	function spotCancelOrder(orderId) {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&order_id=" + orderId
				+ "&symbol=ltc_usd&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_spotusd_cancel_order','parameters':{'api_key':'" + okCoinWebSocket.api_key
				+ "','sign':'" + sign + "','symbol':'ltc_usd','order_id':'" + orderId + "'}}");
	}

	//现货个人信息
	function spotUserInfo() {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_spotusd_userinfo','parameters' :{'api_key':'"
				+ okCoinWebSocket.api_key + "','sign':'" + sign + "'}}");
	}

	//查询订单信息
	function spotOrderInfo(){
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&order_id=20914907&secret_key=" + okCoinWebSocket.secret_key + "&symbol=ltc_usd");
		doSend("{'event':'addChannel','channel':'ok_spotusd_orderinfo','parameters' :{'api_key':'"
				+ okCoinWebSocket.api_key + "','symbol':'ltc_usd','order_id':'20914907','sign':'" + sign + "'}}");
	}
	//订阅交易数据
	function spotTrades() {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_sub_spotusd_trades','parameters' :{'api_key':'"
				+ okCoinWebSocket.api_key + "','sign':'" + sign + "'}}");
	}
	//订阅账户信息
	function spotUserinfos() {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_sub_spotusd_userinfo','parameters' :{'api_key':'"
				+ okCoinWebSocket.api_key + "','sign':'" + sign + "'}}");
	}

	//合约下单
	function futureTrade() {
		var sign = MD5("amount=1&api_key=" + okCoinWebSocket.api_key +
				"&contract_type=this_week&lever_rate=20&match_price=1&price=1.5&symbol=ltc_usd&type=0&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event': 'addChannel','channel':'ok_futureusd_trade','parameters': {'api_key': '"
				+ okCoinWebSocket.api_key + "','sign': '" + sign + "','symbol': 'ltc_usd','contract_type': 'this_week','amount': '1','price': '1.5','type': '0','match_price': '1','lever_rate': '20'}}");
	}

	//合约取消订单
	function futureCancelOrder(orderId) {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&contract_type=this_week&order_id=" + orderId
				+ "&symbol=ltc_usd&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event': 'addChannel','channel': 'ok_futureusd_cancel_order','parameters': {'api_key': '"
				+ okCoinWebSocket.api_key + "','sign': '" + sign + "','symbol': 'ltc_usd','order_id': '" + orderId
				+ "','contract_type': 'this_week'}}");
	}

	//合约个人信息
	function futureUserInfo() {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_futureusd_userinfo','parameters' :{'api_key':'"
				+ okCoinWebSocket.api_key + "','sign':'" + sign + "'}}");
	}

	//查询合约订单
	function futureOrderInfo(orderId) {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&contract_type=this_week&current_page=1&order_id=" + orderId
				+ "&page_length=1&symbol=ltc_usd&secret_key=" + okCoinWebSocket.secret_key + "&status=1");
		doSend("{'event': 'addChannel','channel': 'ok_futureusd_orderinfo','parameters': {'api_key': '"
				+ okCoinWebSocket.api_key + "','sign': '" + sign + "','symbol': 'ltc_usd','order_id': '" + orderId
				+ "','contract_type': 'this_week','status':'1','current_page':'1','page_length':'1'}}");
	}

	//订阅合约交易数据
	function futureTrades() {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_sub_futureusd_trades','parameters' :{'api_key':'"
				+ okCoinWebSocket.api_key + "','sign':'" + sign + "'}}");
	}

	//订阅合约账户信息
	function futureUserinfos() {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_sub_futureusd_userinfo','parameters' :{'api_key':'"
				+ okCoinWebSocket.api_key + "','sign':'" + sign + "'}}");
	}

	//订阅合约持仓信息
	function futurePositions() {
		var sign = MD5("api_key=" + okCoinWebSocket.api_key + "&secret_key=" + okCoinWebSocket.secret_key);
		doSend("{'event':'addChannel','channel':'ok_sub_futureusd_positions','parameters' :{'api_key':'"
				+ okCoinWebSocket.api_key + "','sign':'" + sign + "'}}");
	}

	window.onload = okCoinWebSocket.init("wss://real.okex.com:10440/websocket/okexapi", "", "");
    //okCoinWebSocket.websocket.Open();
    //onOpen();
</script>
</body>
</html>
